<!DOCTYPE html>
<html>
<head>
    <title>Milestone Tracking Board</title>
    <!--  (c) 2015 Rally Software Development Corp.  All Rights Reserved. -->
    <!--  Build Date: Mon Sep 18 2017 15:29:53 GMT-0600 (MDT) -->
    
    <script type="text/javascript">
        var APP_BUILD_DATE = "Mon Sep 18 2017 15:29:53 GMT-0600 (MDT)";
        var CHECKSUM = 171023956825;
    </script>
    
    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function() {
            Ext.define("Rally.technicalservices.InfoLink",{extend:"Rally.ui.dialog.Dialog",alias:"widget.tsinfolink",informationHtml:null,title:"Build Information",defaults:{padding:5,margin:5},closable:!0,draggable:!0,autoShow:!0,width:350,initComponent:function(){Ext.id(this);this.title="<span class='icon-help'> </span>"+this.title,this.callParent(arguments)},_generateChecksum:function(a){var b,c=305419896;for(a=a.replace(/var CHECKSUM = .*;/,""),a=a.replace(/\s/g,""),b=0;b<a.length;b++)c+=a.charCodeAt(b)*b;return c},_checkChecksum:function(a){var b=Ext.create("Deft.Deferred");console.log("_checkChecksum",a);var c=this;return Ext.Ajax.request({url:document.URL,params:{id:1},success:function(a){return text=a.responseText,CHECKSUM&&CHECKSUM!==c._generateChecksum(text)?(console.log("Checksums don't match!"),void b.resolve(!1)):void b.resolve(!0)}}),b.promise},afterRender:function(){var a=Rally.getApp();a.isExternal()?this.addDocked({xtype:"container",cls:"build-info",padding:2,html:"... Running externally"}):this._checkChecksum(a).then({scope:this,success:function(a){a||this.addDocked({xtype:"container",cls:"build-info",padding:2,html:'<span class="icon-warning"> </span>Checksums do not match'})},failure:function(a){console.log("oops:",a)}}),this.callParent(arguments)},beforeRender:function(){this.callParent(arguments),this.informationHtml&&this.addDocked({xtype:"component",componentCls:"intro-panel",padding:2,html:this.informationHtml}),this.addDocked({xtype:"container",cls:"build-info",padding:2,html:"This app was created by the Rally Technical Services Team."}),APP_BUILD_DATE&&this.addDocked({xtype:"container",cls:"build-info",padding:2,html:"Build date/time: "+APP_BUILD_DATE})}}),Ext.define("Rally.technicalservices.Logger",{constructor:function(a){Ext.apply(this,a)},log:function(a){var b="[ "+Ext.util.Format.date(new Date,"Y-m-d H:i:s.u")+" ]",c=[];c=Ext.Array.push(c,[b]),c=Ext.Array.push(c,Ext.Array.slice(arguments,0)),window.console&&console.log.apply(console,c)}}),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.BannerWidget",{extend:"Ext.Component",alias:"widget.bannerwidget",config:{expanded:!0},cls:"stat-panel",data:{},tpl:['<div class="expanded-widget"></div>','<div class="collapsed-widget"></div>'],onRender:function(){this.expanded?this.removeCls("collapsed"):this.addCls("collapsed"),this.callParent(arguments)},expand:function(){this.removeCls("collapsed"),this.setExpanded(!0)},collapse:function(){this.addCls("collapsed"),this.setExpanded(!1)}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.ConfigurableGauge",{extend:"MilestoneTrackingApp.BannerWidget",alias:"widget.statsbannerconfigurablegauge",requires:["Rally.ui.chart.Chart","Rally.util.Timebox","Rally.util.Colors"],tpl:['<div class="expanded-widget">','<div class="stat-title" id="{uniqueid}" >{title}&nbsp;<span class="icon-help"></span></div>','<div class="stat-metric">','<div class="metric-chart"></div>','<div class="metric-chart-text percent-offset">','{percentage}<div class="metric-percent">%</div>',"</div>",'<div class="metric-subtext">{calculatedUnits} of {totalUnits} {unit}<tpl if="secondaryUnit">, {secondaryCalculatedUnits} of {secondaryTotalUnits} {secondaryUnit}</tpl></div>',"</div>","</div>",'<div class="collapsed-widget">','<div class="stat-title">{title}</div>','<div class="stat-metric">{percentage}<span class="metric-percent">%</span></div>',"</div>"],config:{calculatedUnitFilter:null,totalUnitFilter:null,data:{percentage:0,calculatedUnits:0,totalUnits:0,unit:"",title:""}},_tzOffsetPromises:{},getTooltip:function(a){return a.tooltip?a.tooltip:""},initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments)},onDataChanged:function(){var a=this._getRenderData();this.update(a),this.refreshChart(this._getChartConfig(a))},getChartEl:function(){return this.getEl().down(".metric-chart")},_getRenderData:function(){return{}},updateStore:function(a){this.store=a,this.mon(this.store,"datachanged",this.onDataChanged,this)},_getChartConfig:function(b){var c=[{name:"",y:100,color:Rally.util.Colors.grey1}];if(!a.isEmpty(b))if(b.chartData&&b.chartData instanceof Array)c=b.chartData;else{var d=b.percentage,e=d%100||100,f=Rally.util.Colors.cyan_med,g=Rally.util.Colors.grey1;d>100?(f=Rally.util.Colors.blue,g=Rally.util.Colors.cyan):d>70?f=Rally.util.Colors.cyan:0===d&&(f=Rally.util.Colors.grey1),c=[{name:b.title+" Total",y:e,color:f},{name:"",y:100-e,color:g}]}return{chartData:{series:[{data:c}]}}},expand:function(){this.callParent(),this.chart?this.chart.doLayout():this._addChart(this._getChartConfig({}))},onRender:function(){this.callParent(arguments),0===this.store.getRange().length&&this._addEmptyChart(),this.tooltipObject=a.create("Rally.ui.tooltip.ToolTip",{target:this.getEl(),html:this.tooltip}),this.getEl().on("mouseenter",function(a,b){this.tooltipObject.show()},this),this.getEl().on("mouseleave",function(a,b){this.tooltipObject.hide()},this)},_addEmptyChart:function(){this._cleanupChart(),this._addChart({chartData:{series:[{data:[{name:"",y:100,color:Rally.util.Colors.grey1,pct:"N/A"}]}]}})},_cleanupChart:function(){this.chart&&(this.chart.destroy(),delete this.chart)},onDestroy:function(){this._cleanupChart(),this.callParent(arguments)},onResize:function(){this.chart&&!this.getEl().up(".stats-banner.collapsed")&&this.chart.updateLayout(),this.callParent(arguments)},refreshChart:function(b){a.suspendLayouts(),this._cleanupChart(),this.rendered&&this.expanded&&this._addChart(b),a.resumeLayouts(),this.fireEvent("ready",this)},_addChart:function(b){var c=70,d=this._getTooltipConfig(this.enableTooltip);this.chart=a.create("Rally.ui.chart.Chart",a.apply({loadMask:!1,renderTo:this.getChartEl(),cls:"gauge",chartConfig:{chart:{backgroundColor:"rgba(255, 255, 255, 0.1)",defaultSeriesType:"pie",height:c,spacingTop:0,spacingRight:0,spacingBottom:0,spacingLeft:0},plotOptions:{pie:{borderWidth:0,center:["55%","20%"],dataLabels:{enabled:!1},size:.7*c,innerSize:.6*c,enableMouseTracking:!0,shadow:!1}},title:"",tooltip:d}},b))},_getTooltipConfig:function(a){return a?{enabled:!0,backgroundColor:"#000000",borderWidth:0,headerFormat:'<span style="background-color:{point.color};"></span>{point.key}: {point.y}',pointFormat:"",style:{fontFamily:"ProximaNova, Helvetica, Arial",color:"#FFFFFF"}}:{enabled:!1}},_getTZOffset:function(){var b=Rally.util.Ref.getRelativeUri(this.getContext().getProject());if(!a.isDefined(this._tzOffsetPromises[b])){var c=this._tzOffsetPromises[b]=a.create("Deft.Deferred");Rally.environment.getIoProvider().httpGet({url:Rally.environment.getServer().getWsapiUrl()+"/iteration",params:{includeSchema:!0,pagesize:1,fetch:!1,project:b},success:function(a){c.resolve((a.Schema.properties.EndDate.format.tzOffset||0)/60)},requester:this,scope:this})}return this._tzOffsetPromises[b]}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.StatsBanner",{extend:"Ext.container.Container",alias:"widget.statsbanner",mixins:["Rally.Messageable","Rally.clientmetrics.ClientMetricsRecordable"],cls:"stats-banner",layout:"hbox",border:0,width:"100%",stateful:!0,stateEvents:["expand","collapse"],filters:[],firstPortfolioItemName:"Feature",config:{context:null,expanded:!0},items:[{xtype:"statsbanneraccepted",byCount:!0,title:"Accepted User Stories",unitLabel:"User Stories",uniqueid:"accepted-user-stories",expanded:this.expanded,flex:2,tooltip:"<b>Accepted User Stories</b><p>Number of Accepted (or in the higher ScheduledState) User Stories that are explicitly associated with this Milestone.</p>"},{xtype:"statsbanneraccepted",byCount:!1,title:"Accepted Points",unitLabel:"Points",expanded:this.expanded,uniqueid:"accepted-points-user-stories",flex:2,tooltip:"<b>Accepted Points</b> <p>Sum of Story Points tied to the Accepted (or in the higher ScheduledState) User Stories that are explicitly associated with this Milestone.</p>"},{xtype:"statsbannertestcoverage",title:"Test Coverage",unitLabel:"user stories",expanded:this.expanded,flex:2,tooltip:"<b>Test Case Coverage</b> <p>Number of User Stories associated with this Milestone, linked to atleast one test case.</p>"},{xtype:"statsbannertestcases",title:"Test Cases Executed",unitLabel:"executed",expanded:this.expanded,testCaseTypes:[],flex:2,enableTooltip:!0,tooltip:"<b>Test Cases Executed:</b> <p>Test Cases to be considered executed should satisfy all the below:<br/><ol><li>Every Test Case Result has a 'Verdict' (outcome)</li><li>Test Case Result date is less than or equal to the Milestone Target Date</li><li>Every Test Case result has an attachment</li><li>Test Case belongs to an User Story that is associated with this Milestone.</li></ol></p>"},{xtype:"statsbannertestcases",title:"UAT Tests Executed",unitLabel:"executed",testCaseTypes:[],flex:2,enableTooltip:!0,tooltip:"<b>UAT Tests Executed</b> <p>Test Cases to be considered executed should satisfy all the below:<br/><ol><li>Test Type for the Test Case is 'User Acceptance Testing'</li><li>Every Test Case Result has a 'Verdict' (outcome)</li><li>Test Case Result date is less than or equal to the Milestone Target Date</li><li>Every Test Case result has an attachment</li><li>Test Case belongs to an User Story that is associated with this Milestone.</li></ol></p>"},{xtype:"statsbannerdefects",title:"Closed Defects",unitLabel:" Defects",expanded:this.expanded,flex:2,tooltip:"<b>Closed Defects</b> <p>Defects in Closed State that satisfy one of the following<br/><ol><li>Defect is explicitly associated with this Milestone</li><li>Associated with an User Story that is explicitly associated with this Milestone</li><li>Associated with a TestCase that is associated with an User Story that is explicity associated with this Milestone</li></ol></p>"},{xtype:"statsbannercollapseexpand",expanded:this.expanded}],constructor:function(a){this.callParent(arguments)},initComponent:function(){this.addEvents("expand","collapse"),this.subscribe(this,Rally.Message.objectDestroy,this._update,this),this.subscribe(this,Rally.Message.objectCreate,this._update,this),this.subscribe(this,Rally.Message.objectUpdate,this._update,this),this.subscribe(this,Rally.Message.bulkUpdate,this._update,this),this._createWorkItemStore(this.customFilters),this._createTestCaseStore(),this.items[4].testCaseTypes=this.uatTestCaseType,this.items=this._configureItems(this.items),this.on("expand",this._onExpand,this),this.on("collapse",this._onCollapse,this),this.store.on("load",this._checkForLateStories,this),this.testCaseStore.on("load",this._loadTestCaseResults,this),this.callParent(arguments),this._update()},addTestCaseResults:function(a){this.testCaseResults=a},_loadTestCaseResults:function(b,c){if(c&&0!==c.length){var d=Rally.util.DateTime.fromIsoString(this.timeboxRecord.get(this.timeboxEndDateField)),e=this.testCaseResults||null;if(e)_.each(c,function(a){var b=_.filter(e,function(b){return b.get("TestCase").ObjectID===a.get("ObjectID")}),c=_.filter(b,function(a){return a.get("Attachments")&&a.get("Attachments").Count>0});a.set("_resultsTotal",b.length),a.set("_resultsWithAttachments",c.length),a.set("_milestoneTargetDate",d)}),b.fireEvent("datachanged");else{var f=a.Array.map(c,function(a){return{property:"TestCase.ObjectID",value:a.get("ObjectID")}});if(f.length>1&&(f=Rally.data.wsapi.Filter.or(f)),0===f.length)return;Rally.technicalservices.Utilities.fetchWsapiRecords("TestCaseResult",f,["ObjectID","TestCase","WorkProduct","FormattedID","Attachments"]).then({success:function(a){_.each(c,function(b){var c=_.filter(a,function(a){return a.get("TestCase").ObjectID===b.get("ObjectID")}),e=_.filter(c,function(a){return a.get("Attachments")&&a.get("Attachments").Count>0});b.set("_resultsTotal",c.length),b.set("_resultsWithAttachments",e.length),b.set("_milestoneTargetDate",d)}),b.fireEvent("datachanged")},failure:function(a){Rally.ui.notify.Notifier.showError({message:"Error loading Test Case Result Information:  "+a})},scope:this})}}},_checkForLateStories:function(a){var b=[],c=Rally.util.DateTime.fromIsoString(this.timeboxRecord.get(this.timeboxEndDateField));_.each(this.store.getRange(),function(a){var d=a.get("Iteration"),e=a.get("DirectChildrenCount")||0;0===e&&(d?Rally.util.DateTime.fromIsoString(d.EndDate)>c&&b.push(a):b.push(a))},this),b.length>0&&this.fireEvent("latestoriesfound",b)},onRender:function(){this.expanded?this.removeCls("collapsed"):this.addCls("collapsed"),this._setExpandedOnChildItems(),this.callParent(arguments)},applyState:function(b){a.isDefined(b.expanded)&&this.setExpanded(b.expanded),this._setExpandedOnChildItems()},getState:function(){return{expanded:this.expanded}},_setExpandedOnChildItems:function(){_.each(this.items.getRange(),function(a){a.setExpanded(this.expanded)},this)},_getItemDefaults:function(){return{flex:1,context:this.context,store:this.store,listeners:{ready:this._onReady,scope:this}}},_onReady:function(){this._readyCount=(this._readyCount||0)+1,this._readyCount===this.items.getCount()&&(this.recordComponentReady(),delete this._readyCount)},_onCollapse:function(){this.addCls("collapsed"),this.setExpanded(!1),_.invoke(this.items.getRange(),"collapse")},_onExpand:function(){this.removeCls("collapsed"),this.setExpanded(!0),_.invoke(this.items.getRange(),"expand")},_hasTimebox:function(){return!0},_configureItems:function(a){var b=0,c={flex:1,context:this.context,store:this.store,uniqueid:this.uniqueid||"id-"+b++,timeboxRecord:this.timeboxRecord,timeboxEndDateField:this.timeboxEndDateField,scheduleStates:this.scheduleStates,closedDefectStates:this.closedDefectStates,resolvedDefectValues:this.resolvedDefectValues,testCaseStore:this.testCaseStore,listeners:{ready:this._onReady,scope:this}};return _.map(a,function(a){return _.defaults(_.cloneDeep(a),c)})},_update:function(){this._hasTimebox()&&(this.store.load(),this.testCaseStore.load())},_getWorkItemFilters:function(b){var c=a.create("Rally.data.wsapi.Filter",{property:"Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")});if(c=c.or({property:"Requirement.Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")}),c=c.or({property:"TestCase.WorkProduct.Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")}),b&&b.filters&&b.filters.length>0&&b.types&&(a.Array.contains(b.types,"hierarchicalrequirement")||a.Array.contains(b.types,"defect"))){var d=Rally.data.wsapi.Filter.fromQueryString(b.filters.toString());c=c.and(d)}return c},_createTestCaseResultStore:function(){var b=Rally.data.wsapi.Filter.or([{property:"TestCase.Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")},{property:"TestCase.WorkProduct.Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")}]);this.testCaseResultStore=a.create("Rally.data.wsapi.Store",{model:"TestCaseResult",filters:b,fetch:["ObjectID","TestCase","WorkProduct","FormattedID","Attachments"],context:this.context.getDataContext(),pageSize:1e3,limit:"Infinity"})},_createTestCaseStore:function(){var b=a.create("Rally.data.wsapi.Filter",{property:"WorkProduct.Milestones.ObjectID",value:this.timeboxRecord.get("ObjectID")});this.testCaseStore=a.create("Rally.data.wsapi.Store",{model:"TestCase",filters:b,fetch:["LastRun","LastVerdict","Attachments","Type","WorkProduct","ObjectID"],context:this.context.getDataContext(),pageSize:1e3,limit:"Infinity"})},_createWorkItemStore:function(b){var c=this._getWorkItemFilters(b);this.store=a.create("Rally.data.wsapi.artifact.Store",{models:["HierarchicalRequirement","Defect"],fetch:["ObjectID","FormattedID","ScheduleState","PlanEstimate","Iteration","Name","StartDate","EndDate","State","DirectChildrenCount","TestCases","Resolution"],filters:c,pageSize:1e3,context:this.context.getDataContext(),limit:"Infinity"})},updateFilters:function(a){this.store=null,this._createWorkItemStore(a),_.each(this.items.items,function(a){a.updateStore&&a.updateStore(this.store)},this),this.store.load()}})}(),function(){var a=window.Ext4||window.Ext;a.define("technical-services-MilestoneTrackingApp",{extend:"Rally.app.App",componentCls:"iterationtrackingboard",logger:new Rally.technicalservices.Logger,config:{defaultSettings:{ignoreProjectScoping:!0,closedDefectStates:["Closed"],resolvedDefectValues:[],displayTestCaseResultAttachments:!0,uatTestCaseType:"Acceptance",showStatsBanner:!0,collapseStatsBanner:!1}},items:[{xtype:"container",itemId:"selection_box",layout:{type:"hbox"},padding:10},{xtype:"container",itemId:"banner_box"},{xtype:"container",itemId:"grid_box"}],integrationHeaders:{name:"ts-MilestoneTrackingApp"},sModelNames:[],launch:function(){return this.rendered?void Rally.data.ModelFactory.getModel({type:"Defect",success:function(b){var c=[Rally.technicalservices.Utilities.fetchScheduleStates(),Rally.technicalservices.Utilities.fetchPortfolioTypes(),Rally.technicalservices.Utilities.fetchAllowedValues(b,"State"),Rally.technicalservices.Utilities.fetchAllowedValues(b,"Resolution")];Deft.Promise.all(c).then({scope:this,success:function(b){this.logger.log("results",b),this.sModelNames=a.Array.from(_.first(b[1]).get("TypePath")),this.scheduleStates=b[0],this.defectStates=b[2],this.defectResolutions=b[3],this._addComponents()},failure:function(a){Rally.ui.notify.Notifier.showError({message:a})}})},scope:this}):void this.on("afterrender",this.launch,this,{single:!0})},_addComponents:function(){this.logger.log("_addComponents"),this.down("#selection_box").removeAll(),this.down("#banner_box").removeAll(),this.down("#grid_box").removeAll(),this.down("rallygridboard")&&this.down("rallygridboard").destroy();var b=a.create("Rally.data.wsapi.Filter",{property:"Projects",operator:"contains",value:this.getContext().getProject()._ref});if(b=b.or({property:"TargetProject",value:null}),this.logger.log("filters",b.toString()),!this._hasMilestoneScope()){var c=this.down("#selection_box").add({xtype:"rallymilestonecombobox",stateful:!0,stateId:this.getContext().getScopedStateId("milestone-cb"),emptyText:"Select a Milestone...",storeConfig:{filters:b,remoteFilter:!0,limit:"Infinity",pageSize:200}});c.on("select",this._update,this),c.on("ready",this._update,this)}var d=new a.XTemplate('<div class="selector-msg"><tpl if="days &gt;= 0">Target Date: {targetDate} ({days} days remaining)','<tpl elseif="days &lt; 0">Target Date: {targetDate} <span style="color:red;">({days*(-1)} days past)</span>','<tpl elseif="message"><span style="color:#888888;">{message}</span>','<tpl else><span style="color:red;">No target date set for milestone</span></tpl></div>');this.down("#selection_box").add({xtype:"container",itemId:"remaining-days",flex:1,tpl:d});var e=new a.XTemplate('<tpl if="latestories &gt; 0"><div class="picto icon-warning warning" style="color:#FAD200;font-size:16px;"></div>','<div class="latestories">{latestories} Late Stories</div></tpl>');this.down("#selection_box").add({xtype:"container",itemId:"late-stories",flex:1,style:{textAlign:"right",cursor:"pointer"},tpl:e,listeners:{scope:this,afterrender:function(a){a.getEl().on("click",this._showLateStoriesPopover,this)}}}),this._hasMilestoneScope()&&this._update()},_showLateStoriesPopover:function(b,c){if(this.logger.log("_showLateStoriesPopover",c),this.lateStories&&this.lateStories.length>0){var d=_.map(this.lateStories,function(b){return a.String.format("<li>{0}: {1} ({2})",b.get("FormattedID"),b.get("Name"),b.get("Iteration")&&b.get("Iteration").Name||"Unscheduled")});d=a.String.format("<ul>{0}</ul>",d),d+="<br/><i>Late Stories are work items that are scheduled into an iteration that ends after the Milestone target date or items that are not scheduled into an iteration.</i>";var e=a.create("Rally.ui.tooltip.ToolTip",{target:c,html:d,destroyAfterHide:!0});e.show()}},_update:function(){this.down("#banner_box").removeAll(),this.down("#grid_box").removeAll(),this.down("rallygridboard")&&this.down("rallygridboard").destroy();var a=this._getTimeBoxRecord();if(this.logger.log("_update",a),!a)return void this.down("#remaining-days").update({message:"No Milestone selected."});var b=Rally.util.DateTime.fromIsoString(a.get("TargetDate")),c=Rally.util.DateTime.getDifference(b,new Date,"day"),d=Rally.util.DateTime.formatWithDefault(b);this.down("#remaining-days").update({days:c,targetDate:d}),this._getGridStore().then({success:this._addGridBoard,scope:this})},_getModelNames:function(){return this.logger.log("_getModelNames",this.sModelNames),this.sModelNames.concat(["HierarchicalRequirement","Defect","TestCase","TestSet"])},getSettingsFields:function(){var b=this.getSettings(),c=this.defectStates||[],d=this.defectResolutions||[],e=[],f=200,g=600;this.logger.log("getSettingsFields",c,d,b);var h=b&&b.closedDefectStates;h&&a.isString(h)&&(h=h.split(","));var i=_.map(c,function(b){var c=a.Array.contains(h,b);return{boxLabel:b,name:"closedDefectStates",inputValue:b,checked:c}}),j=b&&b.resolvedDefectValues||[];j&&a.isString(j)&&(j=j.split(","));var k=_.map(d,function(b){var c=a.Array.contains(j,b);return{boxLabel:b,name:"resolvedDefectValues",inputValue:b,checked:c}});return e.push({xtype:"checkboxgroup",fieldLabel:"Closed Defect States",labelWidth:f,width:g,labelAlign:"right",columns:2,vertical:!0,margin:"15 0 15 0",items:i}),e.push({xtype:"checkboxgroup",fieldLabel:"Exclude Defects with Resolution",labelWidth:f,width:g,labelAlign:"right",columns:2,vertical:!0,margin:"15 0 15 0",items:k}),e.push({name:"uatTestCaseType",xtype:"rallyfieldvaluecombobox",fieldLabel:"UAT Test Type",labelWidth:f,labelAlign:"right",model:"TestCase",field:"Type",listeners:{ready:function(a){a.setValue(b.uatTestCaseType)}}}),e.push({name:"displayTestCaseResultAttachments",xtype:"rallycheckboxfield",labelWidth:f,labelAlign:"right",fieldLabel:"Show TestCaseResult Attachments"}),e.push({name:"showStatsBanner",xtype:"rallycheckboxfield",fieldLabel:"Show Stats Banner",labelWidth:f,labelAlign:"right"}),e},_getTCRFilters:function(){var a=[];if(this._getTimeBoxRecord()){var b=this._getTimeBoxRecord();a=Rally.data.wsapi.Filter.or([{property:"TestCase.Milestones.ObjectID",value:b.get("ObjectID")},{property:"TestCase.WorkProduct.Milestones.ObjectID",value:b.get("ObjectID")}])}return this.logger.log("_getFilters",a.toString()),a},_getTCRFilters2:function(b){var c=a.Array.map(b,function(a){return{property:"TestCase.ObjectID",value:a.get("ObjectID")}});return c.length>1&&(c=Rally.data.wsapi.Filter.or(c)),this.logger.log("_getFilters",c.toString()),c},_getFilters:function(){var a=[];if(this._getTimeBoxRecord()){var b=this._getTimeBoxRecord();a=Rally.data.wsapi.Filter.or([{property:"Milestones.ObjectID",value:b.get("ObjectID")},{property:"Requirement.Milestones.ObjectID",value:b.get("ObjectID")},{property:"WorkProduct.Milestones.ObjectID",value:b.get("ObjectID")}])}return this.logger.log("_getFilters",a.toString()),a},_getMilestoneRef:function(){var a=this._getTimeBoxRecord();return a?a.get("_ref"):null},_getTimeBoxRecord:function(){return this.down("rallymilestonecombobox")&&this.down("rallymilestonecombobox").getRecord()?this.down("rallymilestonecombobox").getRecord():this._hasMilestoneScope()?this.getContext().getTimeboxScope().getRecord()||null:null},_hasMilestoneScope:function(){return this.logger.log("_hasMilestoneScope",this.getContext().getTimeboxScope()),this.getContext().getTimeboxScope()&&"milestone"===this.getContext().getTimeboxScope().type.toLowerCase()?!0:!1},onTimeboxScopeChange:function(a){a&&"milestone"===a.getType().toLowerCase()&&(this.callParent(arguments),this._update())},_getGridStore:function(){var b={models:this._getModelNames(),autoLoad:!1,remoteSort:!0,pageSize:200,limit:"Infinity",root:{expanded:!0},enableHierarchy:!0,context:{project:null}};return b.filters=this._getFilters(),this.testCaseResults=null,a.create("Rally.data.wsapi.TreeStoreBuilder").build(b).then({success:function(a){return a.on("load",this._loadAttachmentInformation,this),a},scope:this})},getDisplayTestCaseResultAttachments:function(){return"true"===this.getSetting("displayTestCaseResultAttachments")||this.getSetting("displayTestCaseResultAttachments")===!0},_updateTestCases:function(a,b){if(a){var c=this.getDisplayTestCaseResultAttachments(),d=Rally.util.DateTime.fromIsoString(this._getTimeBoxRecord().get("TargetDate"));this.logger.log("_updateTestCases",c,d,a.length,b.length),_.each(b,function(b){var e=_.filter(a,function(a){return a.get("TestCase").ObjectID===b.get("ObjectID")}),f=_.filter(e,function(a){return a.get("Attachments")&&a.get("Attachments").Count>0||0});b.set("_showAttachments",c),b.set("resultsTotal",e.length),b.set("resultsWithAttachments",f.length),b.set("_milestoneTargetDate",d)})}},_onLoad:function(a){this.logger.log("_onLoad customFilter",a.currentCustomFilter),this.down("statsbanner")?this.down("statsbanner").updateFilters(a.currentCustomFilter):this._addStatsBanner(a.currentCustomFilter)},_loadAttachmentInformation:function(a,b,c){if(this.logger.log("_loadAttachmentInformation",a,c),c&&0!==c.length){var d=_.filter(c,function(a){return"testcase"===a.get("_type")});this.logger.log("_loadAttachmentInformation testCases",d.length),d&&0!==d.length&&(this.testCaseResults?this._updateTestCases(this.testCaseResults,d):(this.setLoading(!0),Rally.technicalservices.Utilities.fetchWsapiRecords("TestCaseResult",this._getTCRFilters2(d),["ObjectID","TestCase","WorkProduct","FormattedID","Attachments","TestSet"]).then({success:function(a){this.logger.log("_loadAttachmentsInformation load success",a),this.testCaseResults=a,this._updateTestCases(a,d),this.getStatsBanner()&&this.getStatsBanner().addTestCaseResults(a)},failure:function(a){Rally.ui.notify.Notifier.showError({message:"Error loading Test Case Result Attachment Information:  "+a}),this.logger.log("_loadAttachmentsInformation load error",a)},scope:this}).always(function(){this.setLoading(!1)},this)))}},_updateLateStories:function(a){this.logger.log("_updateLateStories",a),this.down("#late-stories").update({latestories:a.length}),this.lateStories=a},getStatsBanner:function(){return this.down("statsbanner")},_addStatsBanner:function(b){if(this.getSetting("showStatsBanner")){var c=this.getSetting("closedDefectStates")||[],d=this.getSetting("resolvedDefectValues")||[],e=[this.getSetting("uatTestCaseType")];this.logger.log("_addStatsBanner",c,d,e,this.testCaseResults),a.isString(c)&&(c=c.split(",")),a.isString(d)&&(d=d.split(",")),this.logger.log("_addStatsBanner",c,d),this.remove("statsBanner");var f=this.down("#banner_box").add({xtype:"statsbanner",itemId:"statsBanner",scheduleStates:this.scheduleStates,context:this.getContext(),timeboxRecord:this._getTimeBoxRecord(),timeboxEndDateField:"TargetDate",filters:this._getFilters(),customFilters:b,closedDefectStates:c,resolvedDefectValues:d,uatTestCaseType:e,expanded:this.getSetting("collapseStatsBanner")!==!0,margin:"0 0 5px 0",listeners:{resize:this._resizeGridBoardToFillSpace,scope:this,latestoriesfound:this._updateLateStories}});this.testCaseResults&&f.addTestCaseResults(this.testCaseResults)}},_addGridBoard:function(a){var b=this.getContext();this.logger.log("_addGridboard",b),this.gridboard=this.add({itemId:"gridBoard",xtype:"rallygridboard",stateId:"portfoliotracking-gridboard",context:b,plugins:this._getGridBoardPlugins(),modelNames:this._getModelNames(),gridConfig:this._getGridConfig(a),addNewPluginConfig:{style:{"float":"left","margin-right":"5px"}},listeners:{load:this._onLoad,afterrender:function(){this.setWidth(this.getWidth()+1)},scope:this},height:Math.max(this.getAvailableGridBoardHeight()-50,150)})},getAvailableGridBoardHeight:function(){var a=this.getHeight();return this.down("#statsBanner")&&this.down("#statsBanner").rendered&&(a-=this.down("#statsBanner").getHeight()),a},_getGridBoardPlugins:function(){var b=["rallygridboardaddnew"],c=this.getContext(),d=["FormattedID","Name","Owner"];return c.getWorkspace().WorkspaceConfiguration.DragDropRankingEnabled&&d.push("DragAndDropRank"),b.push({ptype:"rallygridboardfilterinfo",isGloballyScoped:a.isEmpty(this.getSetting("project")),stateId:"iteration-tracking-owner-filter-"+this.getAppId()}),b.push({ptype:"rallygridboardfieldpicker",headerPosition:"left",gridFieldBlackList:["ObjectID","Description","DisplayColor","Notes","Subscription","Workspace","Changesets","RevisionHistory","Children"],boardFieldBlackList:["ObjectID","Description","DisplayColor","Notes","Rank","DragAndDropRank","Subscription","Workspace","Changesets","RevisionHistory","PortfolioItemType","StateChangedDate","Children"],alwaysSelectedValues:d,modelNames:this.modelNames,boardFieldDefaults:this.getSetting("cardFields")&&this.getSetting("cardFields").split(",")||["Parent","Tasks","Defects","Discussion","PlanEstimate","Iteration"]}),b.push({ptype:"rallygridboardcustomfiltercontrol",filterControlConfig:{modelNames:this._getModelNames(),stateful:!0,stateId:c.getScopedStateId("tracking-filters")},showOwnerFilter:!0,ownerFilterControlConfig:{stateful:!0,stateId:c.getScopedStateId("tracking-owner-filter")}}),b.push({ptype:"rallygridboardactionsmenu",menuItems:[{text:"Export...",handler:function(){window.location=Rally.ui.gridboard.Export.buildCsvExportUrl(this.down("rallygridboard").getGridOrBoard())},scope:this}],buttonConfig:{iconCls:"icon-export"}}),b},setHeight:a.Function.createBuffered(function(){this.superclass.setHeight.apply(this,arguments),this._resizeGridBoardToFillSpace()},100),_resizeGridBoardToFillSpace:function(){this.gridboard&&this.gridboard.setHeight(this.getAvailableGridBoardHeight())},_getCustomViewConfig:function(){var a={ptype:"rallygridboardcustomview",stateId:"iteration-tracking-board-app",defaultGridViews:[{model:["UserStory","Defect","DefectSuite"],name:"Defect Status",state:{cmpState:{expandAfterApply:!0,columns:["Name","State","Discussion","Priority","Severity","FoundIn","FixedIn","Owner"]},filterState:{filter:{defectstatusview:{isActiveFilter:!1,itemId:"defectstatusview",queryString:"((Defects.ObjectID != null) OR (Priority != null))"}}}}},{model:["UserStory","Defect","TestSet","DefectSuite"],name:"Task Status",state:{cmpState:{expandAfterApply:!0,columns:["Name","State","PlanEstimate","TaskEstimate","ToDo","Discussions","Owner"]},filterState:{filter:{taskstatusview:{isActiveFilter:!1,itemId:"taskstatusview",queryString:"(Tasks.ObjectID != null)"}}}}},{model:["UserStory","Defect","TestSet"],name:"Test Status",state:{cmpState:{expandAfterApply:!0,columns:["Name","State","Discussions","LastVerdict","LastBuild","LastRun","ActiveDefects","Priority","Owner"]},filterState:{filter:{teststatusview:{isActiveFilter:!1,itemId:"teststatusview",queryString:"(TestCases.ObjectID != null)"}}}}}]};return a.defaultBoardViews=_.cloneDeep(a.defaultGridViews),_.each(a.defaultBoardViews,function(a){delete a.state.cmpState}),a},_createOwnerFilterItem:function(a){var b=a.isFeatureEnabled("BETA_TRACKING_EXPERIENCE"),c=a.getProjectRef();return b?{xtype:"rallyownerpillfilter",margin:"-15 0 5 0",filterChildren:this.getContext().isFeatureEnabled("S58650_ALLOW_WSAPI_TRAVERSAL_FILTER_FOR_MULTIPLE_TYPES"),project:c,showPills:!1,showClear:!0}:{xtype:"rallyownerfilter",margin:"5 0 5 0",filterChildren:this.getContext().isFeatureEnabled("S58650_ALLOW_WSAPI_TRAVERSAL_FILTER_FOR_MULTIPLE_TYPES"),project:c}},_createTagFilterItem:function(a){var b=a.isFeatureEnabled("BETA_TRACKING_EXPERIENCE");return{xtype:"rallytagpillfilter",margin:b?"-15 0 5 0":"5 0 5 0",showPills:b,showClear:b,remoteFilter:b}},_createModelFilterItem:function(a){return{xtype:"rallymodelfilter",models:this.modelNames,context:a}},_getGridConfig:function(a){var b=this.getContext(),c="release-tracking",d=b.getScopedStateId(c),e={store:a,columnCfgs:["Name"],defaultColumnCfgs:this._getGridColumns(),plugins:[],stateId:d,storeConfig:{filters:this._getFilters(),context:{project:null}},stateful:!0,showPagingToolbar:!0};return e},_getSummaryColumnConfig:function(){var a=(this.getContext().getWorkspace().WorkspaceConfiguration.TaskUnitName,this.getContext().getWorkspace().WorkspaceConfiguration.IterationEstimateUnitName);return[{field:"AcceptedLeafStoryCount",type:"sum",units:"Total"},{field:"AcceptedLeafStoryPlanEstimateTotal",type:"sum",units:a},{field:"LeafStoryCount",
type:"sum",units:"Total"},{field:"LeafStoryPlanEstimateTotal",type:"sum",units:a},{field:"UnEstimatedLeafStoryCount",type:"sum",units:"Total"}]},_getGridColumns:function(a){var b=["FormattedID","Name","PercentDoneByStoryPlanEstimate","PreliminaryEstimate","ScheduleState","PlanEstimate","Blocked","Iteration","Owner","Discussion"];return a&&(b=a),_.pull(b,"FormattedID"),b},_onBoardFilter:function(){this.setLoading(!0)},_onBoardFilterComplete:function(){this.setLoading(!1)},getOptions:function(){return[{text:"About...",handler:this._launchInfo,scope:this}]},_launchInfo:function(){this.about_dialog&&this.about_dialog.destroy(),this.about_dialog=a.create("Rally.technicalservices.InfoLink",{informationHtml:"<br/>"})},isExternal:function(){return"undefined"==typeof this.getAppId()},onSettingsUpdate:function(b){a.apply(this.settings,b),this.logger.log("onSettingsUpdate",this,b),this._addComponents()}})}(),Ext.define("Rally.technicalservices.data.ChunkerStore",{MAX_CHUNK_SIZE:25,logger:new Rally.technicalservices.Logger,config:{model:null,fetch:null,chunkField:null,chunkOids:null},records:null,constructor:function(a){this.initConfig(a)},load:function(){var a=Ext.create("Deft.Deferred"),b=this.chunkOids,c=[];if(b.length>this.MAX_CHUNK_SIZE){var d=0;for(console.log("original array",b);d<b.length;){var e=b.splice(d,this.MAX_CHUNK_SIZE);c.push(this._fetchRecords(e))}}else c.push(this._fetchRecords(b));return 0==c.length&&a.resolve(),Deft.Promise.all(c).then({scope:this,success:function(b){var c=_.flatten(b);a.resolve(c)},failure:function(b){a.resolve([])}}),a},_fetchRecords:function(a){var b=Ext.create("Deft.Deferred"),c=[];Ext.each(a,function(a){c.push({property:this.chunkField,value:a})},this);var d=Rally.data.wsapi.Filter.or(c);return Ext.create("Rally.data.wsapi.Store",{model:this.model,fetch:this.fetch,autoLoad:!0,context:{project:null},filters:d}).load({callback:function(a,c,d){this.logger.log("chunking success",d),d?b.resolve(a):b.reject(c)},scope:this}),b}}),function(){var a=window.Ext4||window.Ext;a.define("Rally.ui.combobox.MilestoneComboBox",{extend:"Rally.ui.combobox.ComboBox",alias:"widget.rallymilestonecombobox",requires:["Rally.util.DateTime","Rally.data.util.Sorter"],mixins:["Rally.ui.MilestoneListHeadings"],config:{allowNoEntry:!1,hideLabel:!0,width:300,storeConfig:{autoLoad:!0,model:a.identityFn("milestone"),remoteFilter:!1,remoteSort:!1,limit:1/0},listConfig:{minWidth:385,cls:"milestone-list",emptyText:"No Milestones Defined"},tpl:a.create("Ext.XTemplate",'<tpl for=".">','<div class="'+a.baseCSSPrefix+'boundlist-item"><div class="milestone-name"><b>{[values.FormattedID]}</b>:  {[values._refObjectName]}</div>','<div class="milestone-date">{[Rally.util.DateTime.formatWithDefault(values.TargetDate)]}</div>','<div class="milestone-raw-date">{[values.TargetDate]}</div>',"</div>","</tpl>")},initComponent:function(){this.storeConfig.sorters=[{sorterFn:Rally.data.util.Sorter.getDefaultSortFn("Milestone")}],this.callParent(arguments)},createPicker:function(){var a=this.callParent(arguments);return a.on({show:this._addListHeaders,refresh:this._addListHeaders,scope:this,filterSelectedNodes:!1}),a}})}();var origGetPrototypeBody=Ext.data.NodeInterface.getPrototypeBody;Ext.override(Rally.ui.grid.data.NodeInterface,{extend:"Ext.data.NodeInterface",statics:Ext.apply(Ext.data.NodeInterface.prototype.self,{noLayoutFields:/^(expanded|loaded|loading|leaf|leafCount)$/,getPrototypeBody:function(){var a=origGetPrototypeBody(),b=a.destroy,c=a.replaceChild,d=a.onChildNodesAvailable;return Ext.apply(a,{save:function(a){a=a||{},a.params=a.params||{},a.params.fetch=a.params.fetch||!0;var b=this.store&&this.store.treeStore||this.store;if(b&&_.isFunction(b.getParentFetch)&&_.isFunction(b.getChildFetch)){var c={node:this,fetch:a.params.fetch};a.params.fetch=1===this.getDepth()?b.getParentFetch(c):b.getChildFetch(c)}return this.self.superclass.save.apply(this,[a])},set:function(a,b){var c,d=Rally.ui.grid.data.NodeInterface.noLayoutFields.test(a)&&this.store&&this.store.ownerTree,e=this.store&&this.store.ownerTree;return d&&e.suspendLayouts(),c=this.callParent(arguments),d&&e.resumeLayouts(),c},destroy:function(a){return this.parentNode&&this.parentNode.decrementLeafCount(),this._removeChildren(),b.apply(this,[a])},replaceChild:function(a,b){return b.replacedByNode=a,c.apply(this,[a,b])},onChildNodesAvailable:function(a,b,c,e){if(!this._isVisible()){var f=this._getView();if(f)return void f.fireEvent("afternonvisibleitemexpand",this)}return d.apply(this,arguments)},updateCollectionCount:function(a,b){var c=this.get(a);c&&(c.Count=b),this.set("dirtyCollection",!0)},incrementLeafCount:function(){this.set("leafCount",(this.get("leafCount")||0)+1),this.set("leaf",!1)},decrementLeafCount:function(){this.set("leafCount",(this.get("leafCount")||1)-1),this.get("leafCount")>1&&this.set("leaf",!0)},resetLeafCount:function(a,b){if(a){var c=this._getLeafCount(b);this.set("leaf",1>c),this.set("leafCount",c)}else this.set("leaf",!0),this.set("leafCount",0)},_isVisible:function(){var a=this.store;return a&&_.isFunction(a.isRootNode)?a.isRootNode(this)||this._getViewNode():!0},_getView:function(){var a=this.store&&this.store.ownerTree;return a&&a.getView()},_getViewNode:function(){var a=this._getView();return a&&a.getNode(this)},_getLeafCount:function(a){var b=this.get("_type").toLowerCase(),c=Ext.Array.from(a[b]||[]),d=_.reduce(c,function(a,b){var c=this.get(b);return c&&c.Count&&(a+=c.Count),a},0,this);return 0===d&&this.get("DirectChildrenCount")>0?this.get("DirectChildrenCount"):d},_removeChildren:function(){this.suspendEvents(!1),_.each(_.clone(this.childNodes),function(a){a.parentNode.decrementLeafCount(),a.parentNode.removeChild(a,!1)}),this.resumeEvents()}})}})}),Ext.define("Rally.ui.renderer.template.AttachmentTemplate",{extend:"Ext.XTemplate",fieldName:"",constructor:function(a){var b=['{[values["'+a.fieldName+'"].Count]}',a];return"Attachments"===a.fieldName?this.callParent(["<tpl>",'<div aria-label="{[this._getTooltipText(values)]}" title="{[this._getTooltipText(values)]}">','<span class="discussion-cnt">{[this._getColumnText(values)]}</span>',"</div>","</tpl>"]):this.callParent(b)},_getTooltipText:function(a){var b=a.Attachments&&a.Attachments.Count||0,c=a.resultsWithAttachments||0,d=a.resultsTotal||0,e=a._showAttachments;return e?Ext.String.format("There are {0} Attachments on the TestCase.  {1} of {2} TestCaseResults have attachments.",b,c,d):""},_getColumnText:function(a){var b=a.resultsWithAttachments||0,c=a.resultsTotal||0,d=a._showAttachments;return d?Ext.String.format("{0}/{1}",b,c):a.Attachments&&a.Attachments.Count||0}}),Ext.define("Rally.ui.renderer.template.LastVerdictTemplate",{extend:"Ext.XTemplate",fieldName:"",constructor:function(a){Ext.QuickTips.init();var b=["{[this._getLastVerdict(values)]}",a];return this.callParent(b)},_getLastVerdict:function(a){var b=[];a.resultsTotal!==a.resultsWithAttachments&&b.push("<li>Not all Test Case Results have Attachments."),a.LastRun>a._milestoneTargetDate&&b.push("<li>Last Verdict ran after Milestone Target Date.");var c=a.LastVerdict;if(b.length>0){var d=a.FormattedID+" not executed because:<br/><br/>"+b.join("<br/>");c+='<div class="picto icon-warning warning" data-qtip="'+d+'" style="color:#FAD200;font-size:16px;margin:10px"></div>'}return c}}),Ext.override(Rally.ui.renderer.RendererFactory,{typeFieldTemplates:{testcase:{attachments:function(a){return Ext.create("Rally.ui.renderer.template.AttachmentTemplate",{fieldName:a.name})},lastverdict:function(a){return Ext.create("Rally.ui.renderer.template.LastVerdictTemplate",{fieldName:a.name})}},milestone:{formattedid:function(a){var b=!0,c=Rally.environment.getContext();if(c){var d="isFeatureEnabled";_.isFunction(c[d])&&c[d]("EDP_MILESTONE_BETA")&&(b=!1)}return Ext.create("Rally.ui.renderer.template.FormattedIDTemplate",{renderIdAsText:b})}},task:{state:function(a){return Ext.create("Rally.ui.renderer.template.ScheduleStateTemplate",{field:a,showTrigger:!0})}}}}),Ext.override(Rally.ui.combobox.FieldValueComboBox,{_loadStoreValues:function(){this.field.getAllowedValueStore().load({requester:this,callback:function(a,b,c){var d=this.store;if(d){var e=[],f=_.map(_.filter(a,this._hasStringValue),this._convertAllowedValueToLabelValuePair,this);if("boolean"===this.field.getType())f=f.concat([this._convertToLabelValuePair("Yes",!0),this._convertToLabelValuePair("No",!1)]);else if(this.field.required===!1){var g="-- No Entry --",h="";this.getUseNullForNoEntryValue()&&(h=null),"rating"===this.field.attributeDefinition.AttributeType.toLowerCase()&&(g=this.getRatingNoEntryString(),h="None"),e.push(this._convertToLabelValuePair(g,h))}d.loadRawData(e.concat(f)),d.fireEvent("load",d,d.getRange(),c),this.onReady()}},scope:this})}}),Ext.override(Rally.ui.grid.FieldColumnFactory,{Attachments:function(){return{sortable:!0,sortType:function(a){return console.log("Attachement sorterFn",a),"a"}}},_blackListedFields:{task:["BuildDefinitions","Changesets","ObjectID","ObjectUUID","RevisionHistory","SchemaVersion","Subscription","TaskIndex","VersionId","Workspace"],defaultBlackList:["Actuals","Blocker","BuildDefinitions","Changesets","Children","ClosedDefectCount","Editors","GrossEstimateConversionRatio","Iterations","LastResult","LandingPage","ObjectID","ObjectUUID","PassingTestCaseCount","PortfolioItem","Predecessors","Releases","RevisionHistory","ScheduleStatePrefix","SchemaVersion","ShortDisplayName","Subscription","Successors","TaskIndex","TeamMembers","TeamMemberships","TestCaseCount","TotalDefectCount","UserIterationCapacities","UserPermissions","UserProfile","VersionId","Workspace"]}}),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.Accepted",{extend:"MilestoneTrackingApp.ConfigurableGauge",alias:"widget.statsbanneraccepted",config:{data:{percentage:0,calculatedUnits:0,totalUnits:0,title:"Accepted Points",byCount:!1}},_getRenderData:function(){var b=0,c=0,d=this.byCount,e=this.scheduleStates.slice(this.scheduleStates.indexOf("Accepted"));a.Array.each(this.store.getRange(),function(f){if("hierarchicalrequirement"===f.get("_type").toLowerCase())if(d)b++,a.Array.contains(e,f.get("ScheduleState"))&&c++;else{var g=f.get("DirectChildrenCount")||0;0===g&&(b+=f.get("PlanEstimate")||0,a.Array.contains(e,f.get("ScheduleState"))&&(c+=f.get("PlanEstimate")||0))}});var f=0===b?0:Math.round(c/b*100),g={percentage:f,calculatedUnits:c,totalUnits:b,unit:this.unitLabel,title:this.title,tooltip:this.tooltip||""};return g}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.CollapseExpand",{extend:"MilestoneTrackingApp.BannerWidget",alias:"widget.statsbannercollapseexpand",requires:[],tpl:['<div class="expanded-widget">','<div class="toggle-icon icon-chevron-up"></div>',"</div>",'<div class="collapsed-widget">','<div class="toggle-icon icon-chevron-down"></div>',"</div>"],componentCls:"collapse-expand",bubbleEvents:["collapse","expand"],afterRender:function(){this.callParent(arguments),this.getEl().on("click",this._onCollapseExpandClick,this),this.fireEvent("ready",this)},_onCollapseExpandClick:function(){this.expanded?this.fireEvent("collapse",this):this.fireEvent("expand",this)},expand:function(){this.callParent(arguments),this.doComponentLayout()},collapse:function(){this.callParent(arguments),this.doComponentLayout()}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.Defects",{extend:"MilestoneTrackingApp.ConfigurableGauge",alias:"widget.statsbannerdefects",config:{data:{percentage:0,calculatedUnits:0,totalUnits:0,title:"Active Defects"}},_getRenderData:function(){var b=0,c=0,d=this.closedDefectStates,e=this.resolvedDefectValues;a.Array.each(this.store.getRange(),function(f){"defect"!==f.get("_type").toLowerCase()||a.Array.contains(e,f.get("Resolution"))||(a.Array.contains(d,f.get("State"))&&c++,b++)});var f=0===b?0:Math.round(c/b*100),g={percentage:f,calculatedUnits:c,totalUnits:b,unit:this.unitLabel,title:this.title,tooltip:this.tooltip};return g}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.Gauge",{extend:"MilestoneTrackingApp.BannerWidget",alias:"widget.statsbannergauge",requires:["Rally.ui.chart.Chart","Rally.util.Timebox","Rally.util.Colors"],config:{context:null,store:null},onDataChanged:a.emptyFn,getChartEl:a.emptyFn,_getChartConfig:a.emptyFn,_tzOffsetPromises:{},initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.callParent(arguments)},expand:function(){this.callParent(),this.chart?this.chart.doLayout():this._addChart(this._getChartConfig({}))},onRender:function(){this.callParent(arguments),this._getTimebox()||this._addEmptyChart()},_getTimebox:function(){return this.getContext().getTimeboxScope()&&this.getContext().getTimeboxScope().getRecord()?this.getContext().getTimeboxScope().getRecord():null},_addEmptyChart:function(){this._cleanupChart(),this._addChart({chartData:{series:[{data:[{name:"",y:100,color:Rally.util.Colors.grey1}]}]}})},_cleanupChart:function(){this.chart&&(this.chart.destroy(),delete this.chart)},onDestroy:function(){this._cleanupChart(),this.callParent(arguments)},onResize:function(){this.chart&&!this.getEl().up(".stats-banner.collapsed")&&this.chart.updateLayout(),this.callParent(arguments)},refreshChart:function(b){a.suspendLayouts(),this._cleanupChart(),this.rendered&&this.expanded&&this._addChart(b),a.resumeLayouts(),this.fireEvent("ready",this)},_addChart:function(b){var c=62;this.chart=a.create("Rally.ui.chart.Chart",a.apply({loadMask:!1,renderTo:this.getChartEl(),cls:"gauge",chartConfig:{chart:{backgroundColor:"rgba(255, 255, 255, 0.1)",defaultSeriesType:"pie",height:c,spacingTop:0,spacingRight:0,spacingBottom:0,spacingLeft:0},plotOptions:{pie:{borderWidth:0,center:["50%","50%"],dataLabels:{enabled:!1},size:c-4,innerSize:c-14,enableMouseTracking:!1,shadow:!1}},title:"",tooltip:{enabled:!1}}},b))},getTimeboxData:function(){return this._getTZOffset().then({success:function(a){var b=this._getTimebox();return b?Rally.util.Timebox.getCounts(b.get("ReleaseStartDate"),b.get("ReleaseDate"),this.getContext().getWorkspace().WorkspaceConfiguration.WorkDays,a):{remaining:0,workdays:0}},scope:this})},_getTZOffset:function(){var b=Rally.util.Ref.getRelativeUri(this.getContext().getProject());if(!a.isDefined(this._tzOffsetPromises[b])){var c=this._tzOffsetPromises[b]=a.create("Deft.Deferred");Rally.environment.getIoProvider().httpGet({url:Rally.environment.getServer().getWsapiUrl()+"/iteration",params:{includeSchema:!0,pagesize:1,fetch:!1,project:b},success:function(a){c.resolve((a.Schema.properties.EndDate.format.tzOffset||0)/60)},requester:this,scope:this})}return this._tzOffsetPromises[b]},getAcceptanceData:function(){var a={accepted:0,total:0,acceptedCount:0,count:0};return _.each(this.store.getRange(),function(b){a.accepted+=b.get("AcceptedLeafStoryPlanEstimateTotal"),a.total+=b.get("LeafStoryPlanEstimateTotal"),a.acceptedCount+=b.get("AcceptedLeafStoryCount"),a.count+=b.get("LeafStoryCount")}),Deft.Promise.when(a)},getEstimatedData:function(){var a={accepted:0,total:0};return _.each(this.store.getRange(),function(b){a.accepted+=b.get("LeafStoryCount")-b.get("UnEstimatedLeafStoryCount"),a.total+=b.get("LeafStoryCount")}),Deft.Promise.when(a)},_getScheduleStates:function(){return this._scheduleStates?Deft.Promise.when(this._scheduleStates):this.store.model.getField("ScheduleState").getAllowedValueStore().load().then({success:function(a){return this._scheduleStates=_.map(a,function(a){return a.get("StringValue")}),this._scheduleStates},scope:this,requester:this})}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.popover.LateStories",{alias:"widget.latestoriespopover",extend:"Rally.ui.popover.Popover",constructor:function(a){a.items=[{xtype:"rallygrid",model:"User Story",headerCls:"leftright-header-text",columnCfgs:["FormattedID","Name","Feature","PlanEstimate","Iteration","Release","Project","Owner"],pagingToolbarCfg:{pageSizes:[5,10,15]},store:a.store}],this.callParent(arguments)}}),a.define("MilestoneTrackingApp.LateStories",{extend:"MilestoneTrackingApp.BannerWidget",alias:"widget.statsbannerlatestories",requires:[],config:{context:null,store:null,data:{activeCount:0}},tpl:['<div class="expanded-widget">','<span style="cursor: pointer">','<div class="stat-title">Late Stories</div>','<div class="stat-metric">','<div class="metric-icon icon-story"></div>{activeCount}','<div class="stat-secondary">Late</div>',"</span>","</div>","</div>",'<div class="collapsed-widget">','<span class="metric-icon icon-story"></span>','<div class="stat-title">Late Stories</div>','<div class="stat-metric">{activeCount}</div>',"</div>"],initComponent:function(){this.mon(this.store,"datachanged",this.onDataChanged,this),this.on("render",function(){this.getEl().on("click",function(){this._onClickLateStories()},this)},this),this.callParent(arguments)},onDataChanged:function(){this.update(this._getRenderData()),this.fireEvent("ready",this)},_getLateStoriesCount:function(){var a=0,b=Rally.util.DateTime.fromIsoString(this.timeboxRecord.get(this.timeboxEndDateField));return _.each(this.store.getRange(),function(c){var d=c.get("Iteration"),e=c.get("DirectChildrenCount")||0;0===e&&(d?Rally.util.DateTime.fromIsoString(d.EndDate)>b&&a++:a++)},this),a},_getRenderData:function(){return{activeCount:this._getLateStoriesCount()}}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.TestCases",{extend:"MilestoneTrackingApp.ConfigurableGauge",alias:"widget.statsbannertestcases",config:{data:{percentage:0,calculatedUnits:0,totalUnits:0,title:"Test Status"}},initComponent:function(){a.QuickTips.init(),this.callParent(arguments),this.mon(this.testCaseStore,"datachanged",this.onDataChanged,this)},_getRenderData:function(){var b=0,c=0,d=0,e=0,f=this.testCaseTypes||[],g=_.filter(this.store.getRange(),function(a){return"hierarchicalrequirement"===a.get("_type")});g=_.map(g,function(a){return a.get("ObjectID")});var h=_.filter(this.testCaseStore.getRange(),function(b){return a.Array.contains(g,b.get("WorkProduct").ObjectID)&&(0===f.length||a.Array.contains(f,b.get("Type")))?!0:!1});a.Array.each(h,function(a){var f=a.get("LastRun")&&a.get("_milestoneTargetDate")&&a.get("LastRun")<a.get("_milestoneTargetDate");a.get("_resultsTotal")&&a.get("_resultsTotal")===a.get("_resultsWithAttachments")&&f&&(d++,"Pass"===a.get("LastVerdict")&&c++,"Fail"===a.get("LastVerdict")&&e++),b++});var i=[{name:"Total",y:b-d,color:Rally.util.Colors.grey1},{name:"Others",y:d-c-e,color:"#FAD200"},{name:"Passed",y:c,color:"#8DC63F"},{name:"Failed",y:e,color:"#F66349"}],j=0===b?0:Math.round(c/b*100),i={chartData:i,title:this.title,unit:this.unitLabel,calculatedUnits:d,totalUnits:b,percentage:j,secondaryCalculatedUnits:c,secondaryTotalUnits:d,secondaryUnit:"passed",tooltip:this.tooltip};return i}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.TestCoverage",{extend:"MilestoneTrackingApp.ConfigurableGauge",alias:"widget.statsbannertestcoverage",config:{data:{percentage:0,calculatedUnits:0,totalUnits:0,title:"Test Coverage"}},_getRenderData:function(){var b=0,c=0;a.Array.each(this.store.getRange(),function(a){if("hierarchicalrequirement"===a.get("_type").toLowerCase()){var d=a.get("TestCases");d&&d.Count>0&&c++,b++}});var d=0===b?0:Math.round(c/b*100),e={percentage:d,calculatedUnits:c,totalUnits:b,unit:this.unitLabel,title:this.title,tooltip:this.tooltip||""};return e}})}(),function(){var a=window.Ext4||window.Ext;a.define("MilestoneTrackingApp.TimeboxEnd",{extend:"MilestoneTrackingApp.ConfigurableGauge",alias:"widget.statsbannertimeboxend",config:{timeboxRecord:null,timeboxEndDateField:null,data:{percentage:0,calculatedUnits:0,totalUnits:0,unitLabel:"days",title:"Milestone End"}},_getRenderData:function(){var a=this.timeboxRecord.get(this.timeboxEndDateField),b=new Date,c=Rally.util.DateTime.getDifference(a,b,"day"),d={percentage:0,calculatedUnits:0,totalUnits:c,unit:this.unitLabel,title:this.title};return d}})}(),Ext.define("Rally.technicalservices.Utilities",{singleton:!0,fetchPortfolioTypes:function(){var a=Ext.create("Deft.Deferred"),b=Ext.create("Rally.data.wsapi.Store",{autoLoad:!1,model:"TypeDefinition",sorters:[{property:"Ordinal",direction:"ASC"}],filters:[{property:"Parent.Name",operator:"=",value:"Portfolio Item"},{property:"Creatable",operator:"=",value:!0}]});return b.load({scope:this,callback:function(b,c,d){console.log("callback",c,d),d?a.resolve(b):a.reject("Error loading Portfolio Item Types:  "+c.error.errors.join(","))}}),a},fetchWsapiCount:function(a,b){var c=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:a,fetch:["ObjectID"],filters:b,limit:1,pageSize:1}).load({callback:function(d,e,f){f?(console.log("operation"),c.resolve(e.resultSet.totalRecords)):c.reject(Ext.String.format("Error getting {0} count for {1}: {2}",a,b.toString(),e.error.errors.join(",")))}}),c},fetchWsapiRecords:function(a,b,c,d){var e=Ext.create("Deft.Deferred");Ext.create("Rally.data.wsapi.Store",{model:a,fetch:c,filters:b,pageSize:1e3,limit:1/0,enablePostGet:!0,context:{project:null}}).load({callback:function(c,d,f){f?e.resolve(c):e.reject(Ext.String.format("Error getting {0} for {1}: {2}",a,b.toString(),d.error.errors.join(",")))}});return e},fetchScheduleStates:function(){var a=Ext.create("Deft.Deferred");return Rally.data.ModelFactory.getModel({type:"HierarchicalRequirement",success:function(b){var c=b.getField("ScheduleState");c.getAllowedValueStore().load({callback:function(b,c,d){if(d){for(var e=[],f=0;f<b.length;f++)e.push(b[f].get("StringValue"));a.resolve(e)}else a.reject("Error loading ScheduleState values for User Story:  "+c.error.errors.join(","))},scope:this})},failure:function(){var b="Could not load schedule states";a.reject(b)}}),a.promise},fetchAllowedValues:function(a,b){var c=Ext.create("Deft.Deferred");return a.getField(b).getAllowedValueStore().load({callback:function(a,b,d){if(d){var e=_.map(a,function(a){return 0===a.get("StringValue").length?"None":a.get("StringValue")});c.resolve(e)}else c.reject("Error fetching category data")},scope:this}),c}});
            
               Rally.launchApp('technical-services-MilestoneTrackingApp', {
                   name: 'Milestone Tracking Board'
               });
        });
    </script>
    
    <style type="text/css">

.app {
}
.icon-help {
    color: #c0c0c0;
    cursor: pointer;
}
a.tooltip {
    position: relative;
    text-decoration: none;
    color: #c0c0c0;
}

a.tooltip span{
    display: none;
}

a.tooltip:hover {
    position: absolute;
    top: -20px;
    left: 0px;
    display: block;
    width: 250px;
    color: white;
    background-color: black;
    border: 1px solid black;
    padding: 5px;
}

.tsinfolink {
    position:absolute;
    right:0px;
    width: 14px;
    height: 14px;
    border-radius: 7px;
    text-align: center;
    color: white;
    background: #C0C0C0;
    border-style: solid;
    border-width: 1px;
    margin-top: 25px;
    margin-right: 5px;
    cursor: pointer;
}
.selector-msg {
    color: #222222;
    font-family: ProximaNovaSemiBold,Helvetica,Arial;
    font-size: 14px;
    margin-top: 0px;
    margin-left: 15px;
    display: inline-block;
}
.latestories{
    color: #222222;
    font-family: ProximaNovaSemiBold,Helvetica,Arial;
    font-size: 14px;
    display: inline-block;
    margin-left: 5px;
    margin-right: 25px;
}
.iterationtrackingboard {
    overflow-y: hidden;
}
.iterationtrackingboard .header {
    line-height: normal;
    padding: 5px 5px 2px 5px;
}
.iterationtrackingboard .header .add-new {
    float: left;
}
.iterationtrackingboard .header .add-new .new {
    margin-left: 0;
}
.iterationtrackingboard .header .rui-triggerfield {
    margin-bottom: 5px;
}
.iterationtrackingboard .blank-slate-msg .x-panel-body {
    clear: both;
    padding-top: 20px;
    text-align: center;
}
.iterationtrackingboard .gridboard-filter-control {
    height: 22px;
    margin: 3px 0px 0px 5px;
}
.iterationtrackingboard .rui-leftright {
    margin-bottom: 10px;
}
.settings-no-grid {
    padding: 10px;
}
.icon-portfolioitem {
    speak: none;
    font-style: normal;
    font-weight: normal;
    font-variant: normal;
    text-transform: none;
    line-height: 1;
    -webkit-font-smoothing: antialiased;
}
.icon-portfolioitem:before {
    content: '\e024';
}
.stat-panel .collapsed-widget,
.stat-panel .collapsed-widget > div {
    display: none;
}
.stat-panel .expanded-widget,
.stat-panel .expanded-widget > div {
    display: block;
}
.stat-panel.collapsed .collapsed-widget,
.stat-panel.collapsed .collapsed-widget > div {
    display: inline-block;
}
.stat-panel.collapsed .expanded-widget,
.stat-panel.collapsed .expanded-widget > div {
    display: none;
}
.stats-banner .stat-panel {
    border-top: 1px solid #d6d6d6;
    border-left: 1px solid #d6d6d6;
    border-bottom: 1px solid #d6d6d6;
    height: 110px;
    text-align: center;
}
.stats-banner .stat-panel:first-child {
    border-left: 0;
}
.stats-banner .stat-panel:last-child {
    border-left-width: 2px;
}
.stats-banner .stat-panel .stat-title {
    color: #222222;
    font-family: ProximaNovaSemiBold, Helvetica, Arial;
    font-size: 12px;
    padding-top: 5px;
}
.stats-banner .stat-panel .stat-metric {
    color: #666666;
    font-family: ProximaNovaLight, Helvetica, Arial;
    font-size: 16px;
    height: 85px;
    padding-top: 20px;
}
.stats-banner .stat-panel .stat-metric .metric-percent {
    display: inline;
    font-size: 12px;
    vertical-align: super;
}
.stats-banner .stat-panel .stat-metric .metric-icon {
    color: #888888;
    font-size: 18px;
    padding-right: 5px;
}
.stats-banner .stat-panel .stat-metric .metric-chart {
    position: absolute;
    top: 22px;
    width: 100%;
    height: 75px;
}
.stats-banner .stat-panel .stat-metric .metric-subtext {
    bottom: 0px;
    color: #888888;
    font-family: ProximaNova, Helvetica, Arial;
    font-size: 11px;
    position: absolute;
    text-transform: lowercase;
    width: 100%;
    height: 20px;
}
.stats-banner .stat-panel .stat-metric .metric-chart-text {
    position: absolute;
    top: 43px;
    width: 100%;
}
.stats-banner .stat-panel .stat-metric .metric-chart-text.percent-offset {
    left: 10px;
    top: 41px;
}
.stats-banner .stat-panel .stat-metric .stat-secondary {
    color: #888888;
    font-family: ProximaNova, Helvetica, Arial;
    font-size: 11px;
    text-transform: lowercase;
}
.stats-banner .stat-panel .stat-metric .stat-carousel {
    display: inline-block;
    font-family: ProximaNova, Helvetica, Arial;
    font-size: 12px;
    margin-top: -20px;
}
.stats-banner .stat-panel .stat-metric .stat-carousel .rally-carousel-pane .x-box-inner {
    top: 0px !important;
}
.stats-banner .stat-panel .stat-metric .stat-carousel .carousel > span {
    display: inline !important;
    width: auto !important;
}
.stats-banner .stat-panel .stat-metric .stat-carousel .carousel > span > div {
    display: block !important;
}
.stats-banner .stat-panel .stat-metric .stat-carousel .carousel .carousel-panel > span {
    display: inline !important;
    width: auto !important;
}
.stats-banner .stat-panel .stat-metric .stat-carousel .carousel .carousel-panel > span > div {
    display: block !important;
}
.stats-banner .stat-panel .chart .highcharts-container {
    cursor: pointer;
}
.stats-banner .stat-panel .gauge .chart .highcharts-container {
    height: 75px;
    cursor: default;
}
.stats-banner .stat-panel .header {
    display: none;
}
.stats-banner .stat-panel.collapse-expand {
    background-color: #f6f6f6;
    width: 23px;
}
.stats-banner .stat-panel.collapse-expand .toggle-icon {
    color: #c0c0c0;
    font-size: 18px;
    position: relative;
    right: 1px;
}
.stats-banner .stat-panel.collapse-expand:hover {
    cursor: pointer;
}
.stats-banner .stat-panel.collapse-expand:hover .toggle-icon {
    color: #888888;
}
.stats-banner.collapsed .stat-panel {
    height: 25px;
    padding-top: 2px;
}
.stats-banner.collapsed .stat-panel .metric-icon {
    color: #888888;
    font-size: 14px;
    padding-right: 5px;
    vertical-align: middle;
}
.stats-banner.collapsed .stat-panel .stat-title {
    color: #222222;
    display: inline;
    font-family: ProximaNovaSemiBold, Helvetica, Arial;
    font-size: 12px;
    vertical-align: middle;
}
.stats-banner.collapsed .stat-panel .stat-metric {
    color: #888888;
    display: inline;
    font-family: ProximaNova, Helvetica, Arial;
    font-size: 14px;
    height: auto;
    padding-top: auto;
    padding-left: 10px;
    vertical-align: middle;
}
.stats-banner.collapsed .stat-panel .stat-metric .stat-metric-secondary {
    font-size: 11px;
}
.stats-banner.collapsed .stat-panel .stat-metric .metric-percent {
    font-size: 10px;
    vertical-align: super;
}
.pie-chart-legend {
    color: #3E576F;
    font-size: 12px;
    padding: 5px;
    border: 1px solid #909090;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
}
.pie-chart-legend .legend-swatch {
    width: 17px;
    height: 12px;
    border: 1px solid #EEE;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    float: left;
    margin: 0 3px 0 6px;
}
.pie-chart-legend .legend-swatch.defined-sample-swatch {
    background: #E0E0E0;
    /* light-gray */
}
.pie-chart-legend .legend-swatch.in-progress-sample-swatch {
    background: #00a9e0;
}
.pie-chart-legend .legend-swatch.completed-sample-swatch {
    background: #8dc63f;
}
.pie-chart-legend .legend-swatch.blocked-sample-swatch {
    background: #EF3F35;
    /* rally red */
}
.iteration-progress-dialog .carousel .carousel-panel .scroll-button span {
    width: 45px;
    height: 50px;
    line-height: 46px;
}
.iteration-progress-dialog .carousel .carousel-panel .scroll-button span:hover {
    background-color: #e6e6e6;
    color: #666666;
}
.iteration-progress-toggle-button-group {
    margin-bottom: 5px;
}
.x-gecko .stats-banner.collapsed .stat-panel .stat-metric {
    line-height: 20px;
    vertical-align: top;
}
.x-gecko .stats-banner.collapsed .stat-panel .stat-metric .metric-percent {
    line-height: 10px;
}
.x-gecko.x-mac .stats-banner.collapsed .stat-panel .stat-metric {
    line-height: 22px;
}
    </style>

</head>
<body></body>
</html>